<!--
Label Studio Template: Unified Review v4 (Sample-level with Paragraphs)
Task: Review ALL sentences for a complete sample - full transcript + translation

Features:
  - Uses Label Studio's native Paragraphs tag with audio sync
  - Single audio player for the whole sample
  - Click on any paragraph to seek and play that segment
  - Per-sentence editing with TextAreas
  - Timestamp display and editing

Pipeline Stage: REVIEW_PREPARED â†’ (review) â†’ VERIFIED

Data format expected:
{
  "sample_id": "uuid",
  "external_id": "youtube_id", 
  "video_title": "...",
  "channel_name": "...",
  "sentence_count": 45,
  "duration_seconds": 180.5,
  "audio_url": "http://localhost:8081/audio/sample_id.wav",
  "paragraphs": [
    {"start": 0.0, "end": 5.2, "text": "Original transcript...", "idx": "000"},
    ...
  ],
  "sentences_html": "<table>...</table>"
}
-->
<View>
  <!-- Header -->
  <Header value="ðŸŽ¯ Sample Review - Transcript &amp; Translation Editing"/>
  
  <!-- Sample Metadata -->
  <View style="display: flex; gap: 20px; margin-bottom: 15px; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; flex-wrap: wrap;">
    <View style="min-width: 150px;">
      <Header value="ðŸ“º Channel" size="5" style="color: white; margin-bottom: 4px;"/>
      <Text name="channel_name_display" value="$channel_name" style="color: white; font-weight: bold;"/>
    </View>
    <View style="min-width: 200px; flex: 1;">
      <Header value="ðŸŽ¬ Video" size="5" style="color: white; margin-bottom: 4px;"/>
      <Text name="video_title_display" value="$video_title" style="color: white; font-weight: bold;"/>
    </View>
    <View>
      <Header value="ðŸ“Š Sentences" size="5" style="color: white; margin-bottom: 4px;"/>
      <Text name="sentence_count_display" value="$sentence_count" style="color: white;"/>
    </View>
    <View>
      <Header value="â±ï¸ Duration" size="5" style="color: white; margin-bottom: 4px;"/>
      <Text name="duration_display" value="$duration_display" style="color: white;"/>
    </View>
    <View>
      <Header value="ðŸ†” Sample" size="5" style="color: white; margin-bottom: 4px;"/>
      <Text name="sample_id_display" value="$external_id" style="color: white; font-family: monospace; font-size: 12px;"/>
    </View>
  </View>
  
  <!-- Main Audio Player - loads the full sample audio -->
  <View style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #2196f3;">
    <Header value="ðŸŽ§ Audio Player - Click on any sentence below to play that segment" size="4"/>
    <Audio name="audio" value="$audio_url" sync="paragraphs" hotkey="space"/>
  </View>
  
  <!-- Instructions -->
  <View style="background: #e8f5e9; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #4caf50;">
    <Header value="ðŸ“‹ Review Instructions" size="4"/>
    <Text name="inst_1" value="1. Click on any sentence to play its audio segment"/>
    <Text name="inst_2" value="2. Use the audio waveform or press SPACE to play/pause"/>
    <Text name="inst_3" value="3. Review and edit transcript/translation in the Editing section"/>
    <Text name="inst_4" value="4. Mark sentences for rejection or adjust timestamps as needed"/>
    <Text name="inst_5" value="5. Submit when all sentences are reviewed"/>
  </View>
  
  <!-- Paragraphs with audio sync - click to play that segment -->
  <View style="background: #fafafa; padding: 15px; border-radius: 8px; margin-bottom: 15px; max-height: 400px; overflow-y: auto;">
    <Header value="ðŸ“ Transcript (click sentence to play audio)" size="4"/>
    <Paragraphs name="paragraphs" 
                value="$paragraphs" 
                layout="dialogue" 
                textKey="text" 
                nameKey="idx"
                audioUrl="$audio_url"
                sync="audio"
                showplayer="false"
                contextscroll="true"/>
  </View>
  
  <!-- Editable sentences table -->
  <View style="background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e0e0e0;">
    <Header value="âœï¸ Edit Sentences" size="4"/>
    <HyperText name="sentences_table" value="$sentences_html"/>
  </View>
  
  <!-- Sample-level Summary -->
  <View style="background: #fce4ec; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #e91e63;">
    <Header value="ðŸ“Š Sample Summary" size="4"/>
    
    <View style="display: flex; gap: 30px; flex-wrap: wrap;">
      <View style="min-width: 200px;">
        <Header value="ðŸ”Š Overall Audio Quality" size="5"/>
        <Choices name="audio_quality" toName="paragraphs" choice="single" showInLine="true">
          <Choice value="good" hotkey="g"/>
          <Choice value="fair" hotkey="f"/>
          <Choice value="poor" hotkey="p"/>
        </Choices>
      </View>
      
      <View style="min-width: 200px;">
        <Header value="ðŸ“ Transcript Quality" size="5"/>
        <Choices name="transcript_quality" toName="paragraphs" choice="single" showInLine="true">
          <Choice value="excellent"/>
          <Choice value="needs_minor_fixes"/>
          <Choice value="needs_major_fixes"/>
        </Choices>
      </View>
      
      <View style="min-width: 200px;">
        <Header value="ðŸ‡»ðŸ‡³ Translation Quality" size="5"/>
        <Choices name="translation_quality" toName="paragraphs" choice="single" showInLine="true">
          <Choice value="excellent"/>
          <Choice value="needs_minor_fixes"/>
          <Choice value="needs_major_fixes"/>
        </Choices>
      </View>
    </View>
    
    <View style="margin-top: 15px; display: flex; gap: 30px; align-items: center;">
      <View>
        <Header value="â­ Confidence" size="5"/>
        <Rating name="confidence" toName="paragraphs" maxRating="5"/>
      </View>
      
      <View style="flex: 1;">
        <Header value="ðŸ“ Additional Notes" size="5"/>
        <TextArea name="notes" 
                  toName="paragraphs" 
                  rows="2" 
                  placeholder="Any notes about this sample..."
                  maxSubmissions="1"/>
      </View>
    </View>
    
    <!-- Sample Decision -->
    <View style="margin-top: 15px;">
      <Header value="âœ… Final Decision" size="5"/>
      <Choices name="decision" toName="paragraphs" choice="single" showInLine="true" required="true">
        <Choice value="approve" hotkey="a"/>
        <Choice value="needs_revision" hotkey="r"/>
        <Choice value="reject" hotkey="x"/>
      </Choices>
    </View>
  </View>
</View>
