<!--
Label Studio Template: Unified Review
Task: Review sentence audio + transcript + translation together in chunks

Pipeline Stage: REVIEW_PREPARED â†’ (review) â†’ VERIFIED

Interface:
- Chunk header with sample/chunk info
- Scrollable list of sentence cards (15 per chunk)
- Each card: Audio player + editable transcript + editable translation
- Boundary adjustment markers
- Quality flags and rejection options

Schema Version: 4.0 (Unified Review System)

Data format expected:
{
  "sample_id": "uuid",
  "external_id": "youtube_id",
  "chunk_index": 0,
  "chunk_count": 5,
  "video_title": "...",
  "sentences": [
    {
      "idx": 0,
      "audio_url": "http://.../review/{sample_id}/sentences/0000.wav",
      "start": 0.0,
      "end": 3.5,
      "text": "Original transcript...",
      "translation": "Vietnamese translation..."
    },
    ...
  ]
}
-->
<View>
  <!-- Header -->
  <Header value="ðŸŽ¯ Unified Review - Audio + Transcript + Translation"/>
  
  <!-- Chunk Metadata -->
  <View style="display: flex; gap: 20px; margin-bottom: 15px; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white;">
    <View>
      <Header value="Video" size="5" style="color: white;"/>
      <Text name="video_title_display" value="$video_title" style="color: white; font-weight: bold;"/>
    </View>
    <View>
      <Header value="Chunk" size="5" style="color: white;"/>
      <Text name="chunk_display" value="$chunk_index" style="color: white;"/>
    </View>
    <View>
      <Header value="Total Chunks" size="5" style="color: white;"/>
      <Text name="chunk_count_display" value="$chunk_count" style="color: white;"/>
    </View>
    <View>
      <Header value="Sample ID" size="5" style="color: white;"/>
      <Text name="sample_id_display" value="$external_id" style="color: white; font-family: monospace;"/>
    </View>
  </View>
  
  <!-- Instructions -->
  <View style="background: #d4edda; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
    <Header value="ðŸ“‹ Review Instructions" size="4"/>
    <View style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
      <View>
        <Text name="inst_title_1" value="ðŸŽ§ For each sentence:"/>
        <View style="margin-left: 15px; font-size: 13px;">
          <Text name="inst_1" value="1. Listen to audio (click play or use space)"/>
          <Text name="inst_2" value="2. Verify transcript matches audio"/>
          <Text name="inst_3" value="3. Check translation captures meaning"/>
          <Text name="inst_4" value="4. Edit if corrections needed"/>
        </View>
      </View>
      <View>
        <Text name="inst_title_2" value="âš¡ Keyboard shortcuts:"/>
        <View style="margin-left: 15px; font-size: 13px;">
          <Text name="key_1" value="Space: Play/pause current audio"/>
          <Text name="key_2" value="Tab: Move to next field"/>
          <Text name="key_3" value="Ctrl+Enter: Submit when done"/>
        </View>
      </View>
    </View>
  </View>
  
  <!-- Sentence Cards using Paragraphs -->
  <View style="max-height: 70vh; overflow-y: auto; padding-right: 10px;">
    <Paragraphs name="sentences" 
                value="$sentences" 
                layout="dialogue"
                contextScroll="true"
                granularity="paragraph">
      
      <!-- Each sentence rendered as a card -->
      <View style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 12px;">
        
        <!-- Sentence Header -->
        <View style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #dee2e6;">
          <View style="display: flex; gap: 15px; align-items: center;">
            <Text name="sentence_idx" value="Sentence #$idx" style="font-weight: bold; color: #495057;"/>
            <Text name="timing" value="[$start - $end]" style="font-family: monospace; color: #6c757d; font-size: 12px;"/>
          </View>
        </View>
        
        <!-- Audio Player -->
        <View style="background: #e9ecef; padding: 10px; border-radius: 6px; margin-bottom: 12px;">
          <Audio name="sentence_audio_$idx" value="$audio_url" hotkey="space"/>
        </View>
        
        <!-- Two Column: Transcript + Translation -->
        <View style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          
          <!-- Transcript Column -->
          <View>
            <Header value="ðŸ“ Transcript (CS)" size="5" style="color: #1976d2;"/>
            <TextArea name="transcript_$idx"
                      value="$text"
                      rows="3"
                      placeholder="Corrected transcript..."
                      editable="true"
                      style="border: 2px solid #1976d2; border-radius: 4px;"/>
          </View>
          
          <!-- Translation Column -->
          <View>
            <Header value="ðŸ‡»ðŸ‡³ Translation (VI)" size="5" style="color: #388e3c;"/>
            <TextArea name="translation_$idx"
                      value="$translation"
                      rows="3"
                      placeholder="Corrected Vietnamese translation..."
                      editable="true"
                      style="border: 2px solid #388e3c; border-radius: 4px;"/>
          </View>
        </View>
        
        <!-- Sentence-level flags -->
        <View style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #dee2e6;">
          <View style="display: flex; gap: 20px; flex-wrap: wrap;">
            <Choices name="flags_$idx" choice="multiple" showInLine="true">
              <Choice value="boundary_adjust" hint="Start/end timing needs adjustment"/>
              <Choice value="transcript_issue" hint="Significant transcript correction"/>
              <Choice value="translation_issue" hint="Significant translation correction"/>
              <Choice value="reject" hint="Exclude this sentence from training"/>
            </Choices>
          </View>
        </View>
        
      </View>
    </Paragraphs>
  </View>
  
  <!-- Chunk-level Summary -->
  <View style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-top: 15px;">
    <Header value="ðŸ“Š Chunk Summary" size="4"/>
    
    <!-- Overall Quality -->
    <View style="display: flex; gap: 30px; margin-bottom: 15px;">
      <View>
        <Header value="Overall Audio Quality" size="5"/>
        <Choices name="audio_quality" choice="single" showInLine="true">
          <Choice value="good" hint="Clear, easy to understand"/>
          <Choice value="fair" hint="Some noise/issues but usable"/>
          <Choice value="poor" hint="Significant quality issues"/>
        </Choices>
      </View>
      <View>
        <Header value="Gemini Translation Quality" size="5"/>
        <Choices name="translation_quality" choice="single" showInLine="true">
          <Choice value="excellent" hint="Minimal corrections needed"/>
          <Choice value="good" hint="Some corrections needed"/>
          <Choice value="poor" hint="Significant rewriting needed"/>
        </Choices>
      </View>
    </View>
    
    <!-- Chunk-level Flags -->
    <View style="margin-bottom: 15px;">
      <Header value="Chunk Issues" size="5"/>
      <Choices name="chunk_issues" choice="multiple" showInLine="true">
        <Choice value="background_noise" hint="Consistent background noise"/>
        <Choice value="multiple_speakers" hint="More than one speaker"/>
        <Choice value="fast_speech" hint="Speech too fast to follow"/>
        <Choice value="heavy_cs" hint="Heavy code-switching, hard to parse"/>
        <Choice value="context_gap" hint="Missing context from previous chunk"/>
      </Choices>
    </View>
    
    <!-- Confidence Rating -->
    <View style="margin-bottom: 15px;">
      <Header value="â­ Confidence in Review" size="5"/>
      <Rating name="confidence" maxRating="5" icon="star" size="medium"/>
    </View>
    
    <!-- Notes -->
    <View>
      <Header value="ðŸ“ Reviewer Notes" size="5"/>
      <TextArea name="notes"
                rows="2"
                placeholder="Any notes about this chunk..."/>
    </View>
  </View>
</View>
