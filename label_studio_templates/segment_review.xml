<!--
Label Studio Template: Segment Review (Round 2)
Task: Verify segment boundaries and transcript accuracy for audio chunks

Pipeline Stage: SEGMENTED â†’ SEGMENT_REVIEW â†’ SEGMENT_VERIFIED

Interface:
- Segment audio player with waveform
- Word-level timestamps display
- Segment boundary adjustment
- Transcript verification

Schema Version: 3.0
-->
<View>
  <Header value="ðŸ”Š Segment Review (Round 2)"/>
  
  <!-- Metadata Display -->
  <View style="display: flex; gap: 20px; margin-bottom: 15px; padding: 10px; background: #e8f4f8; border-radius: 8px;">
    <View>
      <Header value="Video ID" size="5"/>
      <Text name="video_id_display" value="$external_id"/>
    </View>
    <View>
      <Header value="Segment" size="5"/>
      <Text name="segment_index_display" value="$segment_index"/>
    </View>
    <View>
      <Header value="Duration" size="5"/>
      <Text name="duration_display" value="$duration_seconds"/>
    </View>
    <View>
      <Header value="Alignment Score" size="5"/>
      <Text name="alignment_score_display" value="$alignment_score"/>
    </View>
  </View>
  
  <!-- Timing Info -->
  <View style="display: flex; gap: 20px; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
    <View>
      <Header value="Start Time (ms)" size="5"/>
      <Text name="start_time_display" value="$start_time_ms"/>
    </View>
    <View>
      <Header value="End Time (ms)" size="5"/>
      <Text name="end_time_display" value="$end_time_ms"/>
    </View>
  </View>
  
  <!-- Audio Player -->
  <View style="padding: 10px; background: #f5f5f5; border-radius: 8px; margin-bottom: 15px;">
    <Header value="ðŸŽ§ Segment Audio" size="4"/>
    <Audio name="audio" value="$audio" hotkey="space"/>
  </View>
  
  <!-- Instructions -->
  <View style="background: #d4edda; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
    <Header value="ðŸ“‹ Instructions" size="4"/>
    <Text name="instructions" value="Verify the segment and its transcript:"/>
    <View style="margin-left: 20px;">
      <Text value="âœ… Listen to confirm the audio matches the transcript"/>
      <Text value="âœ… Check that the segment starts and ends at natural boundaries"/>
      <Text value="âœ… Verify no words are cut off at boundaries"/>
      <Text value="âœ… Flag any alignment issues"/>
    </View>
  </View>
  
  <!-- Segment Transcript -->
  <View style="margin-bottom: 15px;">
    <Header value="ðŸ“„ Segment Transcript" size="4"/>
    <View style="background: #fff; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
      <Text name="transcript_text" value="$transcript_text" granularity="word"/>
    </View>
  </View>
  
  <!-- Word Timestamps (if available) -->
  <View style="margin-bottom: 15px;">
    <Header value="â±ï¸ Word Timestamps" size="4"/>
    <View style="background: #f8f9fa; padding: 10px; border-radius: 4px; max-height: 150px; overflow-y: auto; font-family: monospace; font-size: 12px;">
      <Text name="word_timestamps_display" value="$word_timestamps_formatted"/>
    </View>
  </View>
  
  <!-- Boundary Assessment -->
  <View style="margin-bottom: 15px;">
    <Header value="âœ‚ï¸ Segment Boundary Quality" size="4"/>
    <Choices name="boundary_quality" toName="audio" choice="single" required="true">
      <Choice value="good" hint="Clean boundaries, no cut words"/>
      <Choice value="minor_issues" hint="Slight cut at boundary, but usable"/>
      <Choice value="needs_adjustment" hint="Words cut off, needs re-segmentation"/>
      <Choice value="reject" hint="Segment is unusable"/>
    </Choices>
  </View>
  
  <!-- Transcript Accuracy -->
  <View style="margin-bottom: 15px;">
    <Header value="ðŸ“ Transcript Accuracy" size="4"/>
    <Choices name="transcript_accuracy" toName="audio" choice="single" required="true">
      <Choice value="accurate" hint="Transcript matches audio perfectly"/>
      <Choice value="minor_errors" hint="Small errors but understandable"/>
      <Choice value="needs_correction" hint="Significant errors"/>
    </Choices>
  </View>
  
  <!-- Corrected Transcript (if needed) -->
  <View style="margin-bottom: 15px;">
    <Header value="âœï¸ Corrected Transcript (if needed)" size="4"/>
    <TextArea name="corrected_transcript" 
              toName="audio" 
              value="$transcript_text"
              rows="4"
              placeholder="Only edit if transcript needs correction..."
              editable="true"/>
  </View>
  
  <!-- Issue Flags -->
  <View style="margin-bottom: 15px;">
    <Header value="ðŸ·ï¸ Issues" size="4"/>
    <Choices name="issues" toName="audio" choice="multiple">
      <Choice value="word_cut_start" hint="Word cut off at start"/>
      <Choice value="word_cut_end" hint="Word cut off at end"/>
      <Choice value="silence_start" hint="Too much silence at start"/>
      <Choice value="silence_end" hint="Too much silence at end"/>
      <Choice value="alignment_mismatch" hint="Words don't align with audio"/>
      <Choice value="wrong_segment" hint="Content from adjacent segment"/>
    </Choices>
  </View>
  
  <!-- Notes -->
  <View>
    <Header value="ðŸ“ Notes" size="4"/>
    <TextArea name="notes" 
              toName="audio"
              rows="2"
              placeholder="Any notes about this segment..."/>
  </View>
</View>
